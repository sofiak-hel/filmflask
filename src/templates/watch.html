<html>

<head>
    <title>{{ video.title }}</title>
</head>

<body>
    <p><a href="/">Back to homepage</a></p>
    <video autoplay="true" src="/video/{{ video.video_id }}" controls=true height="480"></video>
    <h1>{{ video.title }}</h1>
    <p>{{ video.description }}</p>
    <p>Views: {{ video.download_counter }}</p>
    <p>Uploaded: {{ video.upload_time }} by: <a href="/user/{{ video.uploader.handle }}">{{ video.uploader.nickname }}
            (@{{ video.uploader.handle }})</a></p>
    <p>Subscribers: {{ video.uploader.get_subscribers()|length }}</p>
    <img src="/image/{{ video.uploader.avatar_id }}" width=60>

    <p>Likes/Dislikes: {{ video.get_ratings() }}</p>
    {% if me %}
    <form action="/rate/thumbsup" method="post">
        {% include 'csrf_token.html' %}
        <input type="hidden" name="video_id" value="{{ video.video_id }}">
        <input type="submit" value="Thumbs up">
    </form>
    <form action="/rate/thumbsdown" method="post">
        {% include 'csrf_token.html' %}
        <input type="hidden" name="video_id" value="{{ video.video_id }}">
        <input type="submit" value="Thumbs down">
    </form>
    {% set rating = me.get_rating(video.video_id) %}
    {% if rating %}
    {% set rating_text = "liked" if rating == 1 else "disliked" %}
    <p>You've {{ rating_text }} this video. Would you like to remove this rating?</p>
    <form action="/rate/delete" method="post">
        {% include 'csrf_token.html' %}
        <input type="hidden" name="video_id" value="{{ video.video_id }}">
        <input type="submit" value="Delete rating">
    </form>
    {% endif %}
    {% endif %}

    <hr>
    {% if me %}
    <p>Commenting as {{ me.nickname }}</p>
    <form action="/comment" method="post">
        {% include 'csrf_token.html' %}
        <input type="hidden" name="comment_video_id" id="comment_video_id" value="{{ video.video_id }}">
        <textarea name="content" id="content" minlength="1" maxlength="{{ config.COMMENT_MAX_LENGTH }}"
            required></textarea> </br>
        <input type="submit" value="Comment">
    </form>
    {% else %}
    <p>You must be <a href="/login">logged in</a> to post a comment!</p>
    {% endif %}
    <hr>
    {% for comment in video.get_comments() %}
    <div>
        <img src="/image/{{ comment.user.avatar_id }}" width=100>
        <p><a href="/user/{{ video.uploader.handle }}">{{ comment.user.nickname }} (@{{ comment.user.handle }}):</a>
        </p>
        <p>{{ comment.content }}</p>
        <p>{{ comment.timestamp }}</p>
        {% if me.user_id == comment.user.user_id %}

        <form action="/comment/delete" method="post">
            {% include 'csrf_token.html' %}
            <input type="hidden" name="comment_id" value="{{ comment.comment_id }}">
            <input type="submit" value="Delete comment">
        </form>
        {% endif %}
    </div>
    <hr>
    {% endfor %}
</body>

</html>