<html>

<head>
    <title>{{ video.title }}</title>
    {% set rating = 0 %}
    {% if me %}
    {% set rating = me.get_rating(video.video_id) %}
    {% endif %}
    <script>
        let curr_rating = parseInt('{{ rating }}');
    </script>
    <script src="{{ url_for('static',filename='js/watch.js') }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='css/main.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css"
        integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">

    <meta name="csrf" content="{{ csrf_token }}">
</head>

<body>
    {% include 'components/header.html' %}
    <div class="content">
        <video autoplay="true" src="/video/{{ video.video_id }}" controls=true height="480"></video>
        <h1>{{ video.title }}</h1>
        <div class="video-details">
            <div>
                <span class="views">{{ video.download_counter }} views</span> <span class="timestamp">{{
                    video.upload_time
                    }}</span>
            </div>
            {% set ratings = video.get_ratings() %}

            <div class="ratings">
                <span><button class="icon-button" {% if not me %} disabled="true" {% endif %}
                        onclick="thumbsup('{{video.video_id}}')">
                        {% if rating == 1 %}
                        <i id="thumbsup-icon" class="fa fa-thumbs-up fa-lg"></i>
                        {% else %}
                        <i id="thumbsup-icon" class="fa fa-thumbs-o-up fa-lg"></i>
                        {% endif %}
                    </button>
                    <span id="thumbsups">{{ ratings[0] }}</span>
                </span>
                <span><button class="icon-button" {% if not me %} disabled="true" {% endif %}
                        onclick="thumbsdown('{{video.video_id}}')">
                        {% if rating == -1 %}
                        <i id="thumbsdown-icon" class="fa fa-thumbs-down fa-lg"></i>
                        {% else %}
                        <i id="thumbsdown-icon" class="fa fa-thumbs-o-down fa-lg"></i>
                        {% endif %}
                    </button>
                    <span id="thumbsdowns">{{ ratings[1] }}</span>
                </span>
            </div>
        </div>


        <div class="user-tag">
            <a href="/user/{{ video.uploader.handle }}">
                {% set user = video.uploader %}
                {% include 'components/user-detail.html' %}
            </a>
        </div>

        <p class="video-description">{{ video.description }}</p>

        <div class="comment-section">
            {% if me %}
            <span style="display: inline">Commenting as</span>
            <div class="uploader">
                {% set user = me %}
                {% include 'components/user-detail.html' %}
            </div>
            <div class="form comment-form">
                <textarea name="content" id="comment-content" minlength="1" maxlength="{{ config.COMMENT_MAX_LENGTH }}"
                    required></textarea> </br>
                <button class="button" onclick="add_comment('{{video.video_id}}')">Comment</button>
            </div>
            {% else %}
            <p>You must be <a href="/login?redirect={{ url_for(request.endpoint, **request.view_args) }}">logged
                    in</a>
                to post a comment!</p>
            {% endif %}
            {% set comments = video.get_comments() %}
            <div id="comments">
                {% include 'components/comments.html' %}
            </div>
        </div>
    </div>
    {% include 'components/footer.html' %}

</body>

</html>